Running this spec gets a matcher error. We can get this passing by adding `<h3>Post Form</h3>` to the `new.html.erb` view template.


## Building the form in HTML

Our first pass at the form will be in plain HTML. In this reading, we're not concerned with creating any records in the database. Our focus is on the form process. We'll simply be printing out the submitted form params on the show page.

Let's create a spec for this. It's going to take a while for this to pass since we're going to be spending some time on the HTML creation process, but it's a good practice to ensure all new features are tested before the implementation code is added.

As you are updating the code, make sure to test it out in the browser – don't just rely on the tests. It's important to see the errors in both the tests and the browser since you'll want to become familiar with both types of failure messages.

```ruby
# specs/features/post_spec.rb

require 'rails_helper'

describe 'new post' do

  ...
This fails for obvious reasons. Let's follow the TDD process, letting the failures help build our form. The first error says that Capybara can't find the form field `post_title`. To fix that, let's create an HTML form in the `new.html.erb` view template:

```erb
<form>
  <label>Post title:</label><br>
  <input type="text" id="post_title" name="post[title]"><br>

  <label>Post description:</label><br>
  <textarea id="post_description" name="post[description]"></textarea><br>

  <input type="submit" value="Submit Post">
</form>

<%= params.inspect %>
```

The `name` attributes in each `input` should look pretty familiar by now –– they're good ole' nested hashes. Just like Sinatra, Rails takes the user input entered into form fields and stores it in the `params` hash. The `name` attribute for a given `input` field is used as the key within `params` at which the entered data is stored. For instance, the input entered into the "Post title:" field in the above form would be stored as the value of `params[:post][:title]`. Traditionally, Rails apps use that `model[attribute]` syntax for `name` attributes (e.g., `post[title]`). We'll talk more about that in a later lesson.

You'll also notice that we're printing out `params` to the page. Until we set up the form action, clicking `Submit Post` won't actually redirect to a page on which the input values will be visible, but we'd still like to verify that the `params` hash is being populated correctly.

If we run the tests again, we'll see that Capybara expected submitting the form to redirect it to `/posts`, but instead it found itself back on `/posts/new`. Capybara was able to fill in the form elements and click `Submit Post`, but we need to update the form tag with an `action` attribute:

```erb
<form action="<%= posts_path %>">
```

Now the form redirects to `/posts`. However, we also need to add a `method` attribute so that the application knows that we are submitting form data via the `POST` HTTP verb:

```erb
<form action="<%= posts_path %>" method="POST">
```

If you open up the browser and submit the form, you will get the following routing error: `No route matches [POST] "/posts"`. We need to draw a `create` route so that the routing system knows what to do when a `POST` request is sent to the `/posts` resource:

```ruby
# config/routes.rb

resources :posts, only: [:index, :new, :create]
```

If you run `rake routes`, you'll see we now have a `posts#create` action:

```bash
  Prefix Verb URI Pattern          Controller#Action
   posts GET  /posts(.:format)     posts#index
         POST /posts(.:format)     posts#create
new_post GET  /posts/new(.:format) posts#new
```

Running the spec tests again leads to an 'unknown action' error: `The action 'create' could not be found for PostsController`. Let's add a `create` action in `PostsController` and have it create a new `Post` object with the values from `params` and then redirect to the index page:

```ruby

  ...

  <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
  <input type="submit" value="Submit Post">
<% end %>
```

If we run the tests again, we'll see that they're all still passing. Let's take a look at the HTML generated by our Rails `ActionView` methods:

```html
<form action="/posts" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="zkOjrjTG8Lxn0CF8Lt/kFIgWdYyY3NTMbwh+Q9kPX1NrYztgq0GZNCjLFavBXka1Y5QhNjDlhX+dzQoZMzUjOA==" />
  <label>Post title:</label><br>
  <input type="text" id="post_title" name="post[title]"><br>

  <label>Post description:</label><br>
  <textarea id="post_description" name="post[description]"></textarea><br>

  <input type="hidden" name="authenticity_token" id="authenticity_token" value="7SuubeJGbqfm4rO+F5VTS6Wl1SNCTGOr/mrYZKOQLbtICzajfcEHL6n5h2n4FPHqTieBmep1MhgMr6w+SapR0A==" />
  <input type="submit" value="Submit Post">
</form>
```

The `form_tag` Rails helper is smart enough to know that we want to submit the form via the `POST` method, and it automatically renders the HTML that we were writing by hand before. The `form_tag` method also automatically generates the necessary authenticity token, so we can remove the now-redundant `hidden_field_tag`.

Next, let's integrate some other form helpers to let Rails generate the input elements for us. For this form, we'll be using a `text_field_tag` and a `text_area_tag` and passing each the corresponding `name` attribute as a symbol. It's important to keep in mind that form helpers aren't magic –– they're simply Ruby methods that accept arguments, such as the `name` attribute and any additional parameters related to the form's elements. In addition to updating the form fields, we'll also replace the HTML tag for the submit button with a `submit_tag`.

```erb
<%= form_tag posts_path do %>
  <label>Post title:</label><br>
  <%= text_field_tag :'post[title]' %><br>

  <label>Post description:</label><br>
  <%= text_area_tag :'post[description]' %><br>

  <%= submit_tag "Submit Post" %>
<% end %>
```

Let's check out the raw HTML all these helper methods generate for us:

```html
<form action="/posts" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="vq9SMVNk0CjwgZmYomFRhwbo5dfu7tI/2FiR7jOtlVgbj8r/zOO5oL+arU9N4PMm7WqxbUbXg4wqneW02ZfpMw==" />
  <label>Post title:</label><br>
  <input type="text" name="post[title]" id="post_title" /><br>

  <label>Post description:</label><br>
  <textarea name="post[description]" id="post_description">
</textarea><br>

  <input type="submit" name="commit" value="Submit Post" />
</form>
```

Run the spec tests one last time to verify that everything is still passing. You now know how to build a Rails form from scratch and refactor it using Rails form helper methods. Nice work!

<p class='util--hide'>View <a href='https://learn.co/lessons/rails-form_tag-readme'>Rails form_tag</a> on Learn.co and start learning to code for free.</p>
